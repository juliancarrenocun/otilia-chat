<!doctype html>
<html lang="es" dir="ltr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Do√±a Otilia ‚Äì Asistente de Pr√°cticas CUN</title>
  <meta name="description" content="Tu gu√≠a para resolver dudas sobre SGP, ARL, documentos y seguimiento de pr√°cticas en la CUN." />
  <meta name="theme-color" content="#3B81F6" />

  <!-- Open Graph -->
  <meta property="og:title" content="Do√±a Otilia ‚Äì Asistente de Pr√°cticas CUN" />
  <meta property="og:description" content="Resuelve tus dudas de pr√°cticas: SGP, ARL, documentos, seguimiento y cierre." />
  <meta property="og:image" content="assets/otilia-512.png?v=2025-10-09" />
  <meta property="og:type" content="website" />

  <!-- Performance (chat) -->
  <link rel="preconnect" href="https://www.chatbase.co" crossorigin>

  <!-- Icons & PWA -->
  <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon-32.png?v=2025-10-09" />
  <link rel="apple-touch-icon" sizes="180x180" href="assets/apple-touch-icon.png?v=2025-10-09" />
  <link rel="manifest" href="manifest.webmanifest?v=2025-10-09" />

  <!-- Fuente del sistema para carga r√°pida -->
  <style>
    :root{
      --cun-blue:#3B81F6;         /* primario del chat */
      --cun-green:#47A447;        /* acento institucional CUN */
      --bg:#0B1426;               /* fondo header (oscuro limpio) */
      --text:#0F172A;             /* texto principal */
      --muted:#556070;            /* texto secundario */
      --radius:16px;
      --shadow:0 8px 30px rgba(2,6,23,.08);
    }
    *{box-sizing:border-box}
    html,body{margin:0}
    body{
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Liberation Sans", sans-serif;
      color:var(--text);
      background:#fff;
      line-height:1.5;
      -webkit-font-smoothing:antialiased;
      text-rendering:optimizeLegibility;
    }

    /* Header ---------------------------------------------------*/
    .hero{
      background: radial-gradient(1200px 500px at 70% -10%, rgba(71,164,71,.18), transparent 60%), var(--bg);
      color:#fff;
      padding: clamp(32px, 5vw, 64px) 24px;
      position:relative;
      overflow:hidden;
    }
    .container{max-width:1080px;margin:0 auto}
    .brand{display:flex;align-items:center;gap:16px}
    .brand img{width:72px;height:72px;border-radius:50%;box-shadow:var(--shadow);transition:transform .2s ease;}
    .brand img:hover{transform:scale(1.05)}
    .tag{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,.1);backdrop-filter:saturate(140%);font-size:12px}
    .hero h1{margin:14px 0 8px;font-size:clamp(26px,3.4vw,38px)}
    .hero p{margin:0;color:#E6ECFF;max-width:64ch}
    .cta-row{display:flex;gap:12px;margin-top:18px;flex-wrap:wrap}
    .btn{
      appearance:none;border:0;cursor:pointer;text-decoration:none;
      display:inline-flex;align-items:center;gap:10px;
      padding:12px 18px;border-radius:10px;font-weight:600;
      box-shadow:var(--shadow);transition:transform .06s ease,filter .2s ease;
    }
    .btn:hover{transform:translateY(-1px);filter:saturate(110%)}
    .btn:active{transform:translateY(0)}
    .btn-primary{background:var(--cun-blue);color:#fff}
    .btn-ghost{background:#fff;color:var(--text)}
    .btn-secondary{
      background:transparent;
      color:#E6ECFF;
      border:1.6px solid rgba(255,255,255,.35);
    }
    .btn-secondary:hover{
      border-color:#fff;
      background:rgba(255,255,255,.08);
    }

    /* Main -----------------------------------------------------*/
    main{padding:40px 24px}
    .card{
      border:1px solid #E6E9F2;border-radius:var(--radius);box-shadow:var(--shadow);
      padding:24px;background:#fff;
    }
    .grid{display:grid;gap:16px}
    @media (min-width:860px){.grid{grid-template-columns:1.2fr .8fr}}
    h2{margin:0 0 12px;font-size:clamp(20px,2.4vw,28px)}
    ul{margin:0;padding-left:18px}
    li{margin:6px 0}
    .note{
      margin-top:14px;padding:12px;border-left:4px solid var(--cun-green);
      background:#F4FBF6;color:#1E3A1E;border-radius:8px;
    }
    footer{padding:24px;color:var(--muted);text-align:center;border-top:1px solid #EEF2F7}
    .footer-links{display:flex;gap:18px;justify-content:center;flex-wrap:wrap;margin-top:8px}
    .footer-links a{color:var(--muted);text-decoration:none}
    .footer-links a:hover{color:var(--cun-blue)}
  </style>
</head>

<body>
  <header class="hero">
    <div class="container">
      <div class="brand">
        <img src="assets/otilia-512.png" alt="√çcono Do√±a Otilia" />
        <div>
          <div class="tag">üó®Ô∏è Asistente de Pr√°cticas CUN</div>
          <h1>Do√±a Otilia ‚Äì tu gu√≠a para las pr√°cticas</h1>
          <p>Resuelve dudas sobre <strong>SGP</strong>, <strong>ARL</strong>, <strong>documentaci√≥n</strong>, seguimiento y cierre de pr√°cticas.</p>
          <div class="cta-row">
            <a class="btn btn-primary" href="https://bienestaru.cun.edu.co/practicas/?utm_source=otilia&utm_medium=hero_cta&utm_campaign=sgp" target="_blank" rel="noopener">Ir al SGP</a>
            <a class="btn btn-ghost" href="https://sites.google.com/cun.edu.co/practicascun/p%C3%A1gina-principal?utm_source=otilia&utm_medium=hero_cta&utm_campaign=portal" target="_blank" rel="noopener">Portal de pr√°cticas</a>
            <button class="btn btn-secondary" type="button" id="btnChat">Hablar con Otilia</button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="container grid" aria-label="Contenido principal">
    <section class="card">
      <h2>¬øQu√© puedes preguntarle?</h2>
      <ul>
        <li>¬øC√≥mo registro mi pr√°ctica en el SGP?</li>
        <li>¬øQu√© documentos necesito seg√∫n mi modalidad?</li>
        <li>¬øCu√°ndo debo subir la carta de finalizaci√≥n?</li>
        <li>¬øQu√© pasa si la empresa no tiene convenio?</li>
      </ul>
      <div class="note">Consejo: ten a la mano tu correo institucional; lo vas a necesitar para acceder a formatos y al SGP.</div>
    </section>

    <aside class="card" aria-label="Atajos">
      <h2>Accesos √∫tiles</h2>
      <ul>
        <li><a href="https://bienestaru.cun.edu.co/practicas/?utm_source=otilia&utm_medium=sidebar_link&utm_campaign=sgp" target="_blank" rel="noopener">Ingreso a SGP</a></li>
        <li><a href="https://sites.google.com/cun.edu.co/practicascun/p%C3%A1gina-principal?utm_source=otilia&utm_medium=sidebar_link&utm_campaign=portal" target="_blank" rel="noopener">Portal de pr√°cticas (Google Sites)</a></li>
      </ul>
    </aside>
  </main>

  <footer>
    <div>¬© 2025 CUN ‚Äì Coordinaci√≥n de Pr√°cticas</div>
    <nav class="footer-links" aria-label="Enlaces de pie de p√°gina">
      <a href="https://www.cun.edu.co/" target="_blank" rel="noopener">Sitio CUN</a>
      <a href="https://bienestaru.cun.edu.co/practicas/" target="_blank" rel="noopener">SGP</a>
      <a href="https://sites.google.com/cun.edu.co/practicascun/p%C3%A1gina-principal" target="_blank" rel="noopener">Portal de pr√°cticas</a>
    </nav>
  </footer>

  <!-- ====== CHATBASE (snippet oficial) ====== -->
  <script>
  (function(){
    if(!window.chatbase || window.chatbase("getState")!=="initialized"){
      window.chatbase=(...arguments)=>{if(!window.chatbase.q){window.chatbase.q=[]}window.chatbase.q.push(arguments)};
      window.chatbase=new Proxy(window.chatbase,{get(target,prop){if(prop==="q"){return target.q}return(...args)=>target(prop,...args)}});
    }
    const onLoad=function(){
      const script=document.createElement("script");
      script.src="https://www.chatbase.co/embed.min.js";
      script.id="sLDgiXlWpHYwWJV6DdWvp";   /* <- tu ID de embed */
      script.domain="www.chatbase.co";
      document.body.appendChild(script);
    };
    if(document.readyState==="complete"){onLoad()}
    else{window.addEventListener("load",onLoad)}
  })();
  </script>

  <!-- Bot√≥n que abre el chat (con fallback seguro) -->
  <script>
    (function () {
      const openChat = () => {
        try {
          if (window.chatbase && typeof window.chatbase === 'function') {
            try { window.chatbase('open'); return; } catch(e){}
            try { window.chatbase('toggle'); return; } catch(e){}
          }
        } catch (e) {}
        // Fallback: intenta clicar la burbuja del widget
        const clickBubble = () => {
          const bubble = document.querySelector('[class*="Chatbase"] button, .chatbase-bubble, [aria-label*="chat"], [class*="bubble"]');
          if (bubble) bubble.click();
        };
        clickBubble();
        setTimeout(clickBubble, 600);
      };

      const btn = document.getElementById('btnChat');
      if (btn) btn.addEventListener('click', openChat);
    })();
  </script>

  <!-- ====== SERVICE WORKER (PWA y cach√©) ====== -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js?v=2025-10-09');
      });
    }
  </script>
  
  <!-- ===== Audio Otilia: UI m√≠nima (pruebas) ===== -->
<style>
  .otilia-tts {
    position: fixed; right: 18px; bottom: 96px; z-index: 9999;
    display: grid; gap: 8px; width: min(360px, 92vw);
    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue";
  }
  .otilia-tts .bar {
    display:flex; gap:8px; align-items:center; background:#0B1426;
    color:#fff; border-radius:12px; padding:10px 12px; box-shadow:0 8px 30px rgba(2,6,23,.18);
  }
  .otilia-tts textarea {
    width:100%; min-height:64px; resize:vertical; border:1px solid #e6e9f2;
    border-radius:10px; padding:10px 12px; font-size:14px;
  }
  .otilia-tts button {
    border:0; border-radius:10px; padding:10px 12px; cursor:pointer;
    font-weight:600; background:#3B81F6; color:#fff;
  }
  .otilia-tts button.secondary { background:#fff; color:#0F172A; border:1px solid #E6E9F2; }
  .otilia-tts .hint { font-size:12px; color:#667085; text-align:center }
  .otilia-tts .pill { font-size:12px; background:#fff1; padding:4px 8px; border-radius:999px; }
</style>

<div class="otilia-tts" id="otilia-tts">
  <div class="bar">
    <span>üîä</span>
    <strong>Escuchar a Do√±a Otilia</strong>
    <span class="pill" id="otilia-tts-state">Listo</span>
    <div style="margin-left:auto;display:flex;gap:8px">
      <button id="otilia-tts-play">Reproducir</button>
      <button id="otilia-tts-stop" class="secondary">Detener</button>
    </div>
  </div>
  <textarea id="otilia-tts-text" placeholder="Pega aqu√≠ la respuesta de Otilia y presiona Reproducir‚Ä¶"></textarea>
  <div class="hint">Tip: mientras el chat est√© en un <i>iframe</i> de Chatbase, no podemos leer su texto por seguridad del navegador. Cuando tengamos un 'hook' o espejo del mensaje, lo pasamos directo a <code>OtiliaTTS.speak(text)</code>.</div>
</div>

<script>
/**
 * OtiliaTTS ‚Äì TTS bajo demanda con ElevenLabs (demo en cliente).
 * ‚ö†Ô∏è Para producci√≥n, usa el proxy seguro de la secci√≥n 2.
 */
(function () {
  // ======= CONFIG =======
  const API_KEY  = "3d7432ee9fe833b40e43ab19a418f5b5"; // ‚ö†Ô∏è SOLO PARA PRUEBAS
  const VOICE_ID = "Alegria Sana";   // Reemplaza con la voz elegida
  const MODEL_ID = "eleven_multilingual_v2";

  // Controles de voz sugeridos para "abuelita c√°lida"
  const VOICE_SETTINGS = {
    stability: 0.65,          // 0‚Äì1
    similarity_boost: 0.85,   // 0‚Äì1
    style: 0.20,              // 0‚Äì1
    use_speaker_boost: false
  };
  const GENERATION = {        // velocidad (0.7‚Äì1.2)
    // ElevenLabs usa "voice_settings" + "model_id". La Speed se pasa como 'optimize_streaming_latency' (o en body 'voice_settings' si tu plan lo expone). Para compatibilidad:
    // Muchos proyectos controlan "speed" via SSML <prosody rate="..."> (no todos los modelos lo soportan). Aqu√≠ lo dejamos neutro.
  };

  // ======= ESTADO/UI =======
  const $text  = document.getElementById("otilia-tts-text");
  const $play  = document.getElementById("otilia-tts-play");
  const $stop  = document.getElementById("otilia-tts-stop");
  const $state = document.getElementById("otilia-tts-state");

  let audioEl = null;
  let currentUrl = null;

  // Cach√© en memoria: misma frase => no gasta cr√©ditos otra vez
  const cache = new Map(); // key = hash(text+settings) -> objectURL

  function hashKey(text) {
    return `${text}|${JSON.stringify(VOICE_SETTINGS)}|${MODEL_ID}`;
  }

  function setState(label) { $state.textContent = label; }

  async function fetchTTS(text) {
    const key = hashKey(text);
    if (cache.has(key)) {
      return cache.get(key);
    }

    const endpoint = `https://api.elevenlabs.io/v1/text-to-speech/${VOICE_ID}`;

    const body = {
      model_id: MODEL_ID,
      text,
      voice_settings: VOICE_SETTINGS
    };

    const res = await fetch(endpoint, {
      method: "POST",
      headers: {
        "xi-api-key": API_KEY,
        "Content-Type": "application/json",
        "Accept": "audio/mpeg"
      },
      body: JSON.stringify(body)
    });

    if (!res.ok) {
      const errTxt = await res.text().catch(()=>res.statusText);
      throw new Error(`TTS error ${res.status}: ${errTxt}`);
    }
    const blob = await res.blob();
    const url  = URL.createObjectURL(blob);
    cache.set(key, url);
    return url;
  }

  function stopAudio() {
    if (audioEl) {
      audioEl.pause();
      audioEl.src = "";
      audioEl.remove();
      audioEl = null;
    }
    if (currentUrl) {
      URL.revokeObjectURL(currentUrl);
      currentUrl = null;
    }
    setState("Listo");
  }

  async function playText(text) {
    if (!text || !text.trim()) {
      alert("Pega o pasa un texto para reproducir.");
      return;
    }
    stopAudio();
    setState("Generando‚Ä¶");

    try {
      const url = await fetchTTS(text.trim());
      currentUrl = url;
      audioEl = new Audio(url);
      audioEl.oncanplay = () => setState("Reproduciendo‚Ä¶");
      audioEl.onended   = () => setState("Listo");
      audioEl.onerror   = () => setState("Error");
      audioEl.play();
    } catch (err) {
      console.error(err);
      setState("Error");
      alert("No se pudo generar audio. Revisa la consola y tu API Key / VOICE_ID.");
    }
  }

  // Exponer API p√∫blica para cuando tengas el texto del chat:
  window.OtiliaTTS = {
    speak: (text) => playText(text),
    stop:  () => stopAudio()
  };

  // Botones
  $play.addEventListener("click", () => playText($text.value));
  $stop.addEventListener("click", stopAudio);
})();
</script>
</body>
</html>
